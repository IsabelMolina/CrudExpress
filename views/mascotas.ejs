<%- include("template/cabecera", {titulo:"Mascotas"}) %>

    <div class="container">

      <h1><%= titulo %></h1>

        <a href="/mascotas/crear" class="btn btn-primary btn-block my-4" >Crear nueva mascotas</a>
            <% if(!estado){ %>
              <p><%= mensaje %></p>

            <%} else { %>
              <div class="table-responsive">
                <table id="tablaMascotas" class="table">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">Nombre</th>
                      <th scope="col">Descripcion</th>
                      <th scope="col">Accion</th>
                    </tr>

                  </thead>

                  <tbody>
                      <% listaMascotas.forEach(mascota => { %>
                        <tr>
                          <th scope="row"><%= mascota._id %></th>
                          <td><%= mascota.nombre %></td>
                          <td><%= mascota.descripcion %></td>
                          <td>
                            <a type="button" class="btn btn-warning btn-sm" href="mascotas/<%= mascota._id %>">Editar</a>
                            <button class="btn btn-danger btn-sm" data-id="<%= mascota._id %>" onclick="eliminarMascota(this)" >Eliminar</button>
                          </td>
                        </tr>
                      <% }); %>
                  </tbody>

                </table>

              </div>
            <% } %>
    </div>


<%- include("template/footer"); %>

<script>
  async function eliminarMascota(btnEliminar){
    const id = btnEliminar.dataset.id;
    try{
      const data = await fetch(`/mascotas/${id}`,{ method:'delete' });
      const res = await data.json();
      if(res.estado){
        window.location.href = "/mascotas";
      }else{
        console.log(res);
      }
    }
    catch (error){
      console.log(error);
    }
  }

</script>
